# Polymarket 量化交易 - OpenClaw 行动纲领

**创建时间**: 2026-02-12  
**策略基础**: 基于 Swisstony 和 Distinct-baguette 两位大户的链上行为分析  
**Agent架构**: Proactive Agent (v1.2.4)

---

## 📋 执行摘要

本纲领针对 Polymarket 预测市场，设计了两套可并行执行的量化交易策略：

| 策略 | 类型 | 核心逻辑 | 适用场景 | 预期收益 |
|------|------|----------|----------|----------|
| **Swisstony** | 统计套利 (Stat Arb) | 利用 Pinnacle/Betfair (外部最准赔率) 与 Polymarket 的定价错位 | 赌事/体育预测 | 10-20% 月化收益 |
| **Distinct-baguette** | 做市商 | 跨市网格，赚取 Binance 与 Polymarket 的价差 | 加密货币价格关联 | 高频小额收益 |

**推荐策略**: Swisstony (方案 A 2.0)  
**推荐理由**: 
- 门槛低（家用电脑即可，无需 AWS/HFT）
- 容错率高（极度分散，不怕单场黑天鹅）
- 更符合 Agent 特性（信息整合 vs 拼速度）

---

## 🧠 已安装的 Skills

### 1. proactive-agent (v1.2.4)
**功能**: 从任务跟随者转变为主动伙伴  
**用途**: 
- 记忆架构（保存策略参数和交易历史）
- 反向提示（主动发现机会）
- 自愈能力（诊断并修复自身问题）

### 2. tavily-search
**功能**: AI 优化的 Web 搜索  
**用途**: 
- 实时搜索 Polymarket 相关新闻
- 监控 Polymarket 官方公告
- 研究 Pinnacle/Betfair 赔率数据

### 3. find-skills
**功能**: 发现和安装 agent skills  
**用途**: 
- 搜索 Polymarket 相关的 Python 库
- 查找 py-clob-client 更新

---

## 🎯 核心策略详解

### 策略 A: Swisstony (价值投资猎手)

#### 核心原理
> "Swisstony 不赌博，他赌的是大众定价错误。"

利用外部权威数据源（Pinnacle/Betfair）获取真实概率，当 Polymarket 市场定价低于真实概率时买入。

#### 关键要素
1. **真理预言机**
   - 数据源: The Odds API (体育) 或 Metaculus (预测聚合)
   - 脱水处理: 去除庄家抽水，计算真实概率
   - 更新频率: 实时（WebSocket）

2. **安全边际**
   - 只有在显著折扣时才买: `目标买入价 = 公允价 * 0.8`
   - 示例: 真实概率 10% → 目标价 8¢

3. **资金管理**
   - 极度分散: 监控 500+ 市场
   - 单笔固定: $20-$50 (Kelly 比例)
   - 总交易数: 靠 3.5万+ 笔交易拉平波动

4. **执行特征**
   - 挂单等待 (Limit Order Maker)
   - 不追高 (不主动吃单)
   - 阶梯挂单 (在 8¢, 7¢, 6¢ 分别挂单)

#### 实施步骤
1. **安装依赖**
   \`\`\`bash
   pip install py-clob-client pandas
   \`\`\`

2. **编写 Oracle 模块**
   \`\`\`python
   # skill_oracle.py
   def get_fair_value(market_keywords):
       # 1. 获取 Pinnacle 赔率
       odds = pinnacle.get_odds(market_keywords)
       # 2. 去除抽水
       fair_prob = calculate_no_vig_prob(odds)
       return fair_prob  # 例如 0.10 (10%)
   \`\`\`

3. **编写秃鹫挂单引擎**
   \`\`\`python
   # poly_vulture.py
   async def swisstony_strategy(market):
       # 1. 获取公允价值
       fair_value = get_fair_value(market.name)
       
       # 2. 设定安全边际 (85折)
       target_price = fair_value * 0.8  # 例如 0.08
       
       # 3. 阶梯挂单
       orders = []
       for price in [target_price, target_price - 0.01, target_price - 0.02]:
           if price <= 0.01: break
           orders.append(LimitOrder(side="BUY", price=price, size=20))
       
       # 4. LLM 语义风控
       if await check_news_trap(market.name) == "SAFE":
           await client.place_orders(orders)
   \`\`\`

4. **验证方案**
   - KPI: Hit Rate (命中率) vs Odds (赔率)
   - 测试: 模拟跑 3 天，统计 ROI
   - 上线标准: ROI > 10%

---

### 策略 B: Distinct-baguette (做市商)

#### 核心原理
> "他持有库存，赚取 Spread 和 Rebates。"

利用 Binance 价格作为领先指标，通过 Pre-Minting (预铸造) 建立库存，然后在 Polymarket 做网格交易。

#### 关键要素
1. **信号源**
   - 领先指标: Binance WebSocket (实时价格)
   - 中枢计算: Black-Scholes 模型计算理论价

2. **库存管理**
   - Pre-Mint: 1000 USDC → 1000 Yes + 1000 No
   - Delta Neutral: 始终保持对冲，只赚波动

3. **执行特征**
   - 冰山拆单: 将目标仓位切成 20 笔小单
   - 双向网格: 在中枢价格上下铺设买卖单
   - 动态调整: 价格逐笔上移追价

#### 实施步骤
1. **准备库存**
   \`\`\`bash
   # 调用合约铸造
   ctf.split_collateral(amount=1000)  # 获得 1000 Yes + 1000 No
   # 状态: Delta Neutral (风险为 0)
   \`\`\`

2. **编写信号网格脚本**
   \`\`\`python
   # poly_grid.py
   async def baguette_grid(market_up):
       # 1. 获取 Binance 信号
       mid_price = get_binance_implied_price()
       
       # 2. 铺设网格
       buy_orders = [create_limit_buy(mid_price - i*0.01) for i in range(1,6)]
       sell_orders = [create_limit_sell(mid_price + i*0.01) for i in range(1,6)]
       
       await client.place_orders(buy_orders + sell_orders)
       
       # 3. 循环监控
       while True:
           handle_filled_orders()
           await asyncio.sleep(0.2)
   \`\`\`

3. **验证方案**
   - 验证指标: Latency (延迟优势)
   - 测试方法: 记录 Binance 变动时间戳 vs Polymarket 盘口变动时间戳
   - 合格标准: > 1000ms 可行，< 200ms 放弃

---

## ⚙️ 技术架构

### Agent 组件架构

```
┌─────────────────────────────────────────┐
│          OpenClaw Agent             │
│  ┌─────────────────────────────┐   │
│  │  Proactive Agent (v1.2.4)  │   │
│  │  - 记忆架构 (MEMORY.md)  │   │
│  │  - 反向提示            │   │
│  └─────────────────────────────┘   │
│                │                  │
│  ┌─────────────────┐    ┌──────┴──────┐
│  │  Tavily Search  │    │  Polymarket  │
│  │  - 新闻监控    │◄──►│   ClobClient  │
│  └─────────────────┘    └───────────────┘
│                │                  │
│  ┌─────────────────┐    ┌──────────────┐
│  │  Find Skills     │    │  外部数据源  │
│  │  - 工具发现    │◄──►│  - Pinnacle   │
│  └─────────────────┘    │  - Binance WS  │
│                         └──────────────┘
└─────────────────────────────────────────┘
```

### 技术栈

| 组件 | 技术选型 |
|------|----------|
| **运行环境** | Python 3.9+ |
| **Polymarket 客户端** | py-clob-client |
| **数据源** | The Odds API (Pinnacle) |
| **价格监控** | Binance WebSocket |
| **数据分析** | Pandas |
| **Web 搜索** | Tavily API |
| **Agent 框架** | Proactive Agent (v1.2.4) |

---

## 🛡️ 风险控制

### 通用风险

| 风险类型 | 防护措施 |
|-----------|----------|
| **API 限流** | 实现指数退避，错峰请求 |
| **市场剧烈波动** | 设置最大单笔仓位限制 |
| **技术故障** | 心跳检测，自动重启 |
| **资金风险** | 模拟交易 (Paper Trading) 先验证 |

### Swisstony 风险控制

1. **语义避雷**
   - 使用 LLM 检查新闻，确认价格暴跌不是"死局"
   - 示例: 候选人退选 → 不接飞刀

2. **流动性陷阱**
   - 只做短周期 (Sports Only)
   - 避免长周期市场 (Politics)

3. **Maker Fill Rate 监控**
   - 如果成交率过低，提高挂单价格
   - 如果成交率过高，说明挂单价格太低

### Distinct-baguette 风险控制

1. **单边风险**
   - 原子化执行 (FOK - Fill or Kill)
   - 确保要么全成，要么全不成

2. **延迟风险**
   - 延迟测试: 记录 Binance → Polymarket 时间差
   - 放弃策略: 如果 < 200ms，直接放弃

3. **库存管理**
   - 实时监控 Delta
   - 偏离 > 10% 时，立即市价全平

---

## 📊 关键指标 (KPIs)

### Swisstony KPIs

| 指标 | 目标值 | 测量方法 |
|------|--------|----------|
| **Hit Rate (命中率)** | 30% | (Yes 成交数 / 总 Yes 下注数) |
| **Average Odds (平均赔率)** | 4.0 倍 | (总收益 / 总下注金额) |
| **ROI (投资回报率)** | > 10% | (净利润 / 总下注金额) |
| **Maker Fill Rate (成交率)** | 10-20% | (挂单成交数 / 总挂单数) |

### Distinct-baguette KPIs

| 指标 | 目标值 | 测量方法 |
|------|--------|----------|
| **Latency (延迟)** | > 1000ms | (Binance 变动 → Polymarket 响应时间) |
| **Spread Capture (价差捕获)** | > 1% | (卖出价 - 买入价) / 买入价 |
| **Inventory Rebalance (库存再平衡)** | 95%+ | (Yes 数量 ≈ No 数量) |
| **Transaction Success (交易成功率)** | > 95% | (成功订单数 / 总订单数) |

---

## 🚀 实施路线图

### Phase 1: 环境搭建 (第 1-3 天)

- [ ] 安装 Python 3.9+
- [ ] 安装 py-clob-client
- [ ] 配置 Proactive Agent
- [ ] 注册 Tavily API 获取密钥
- [ ] 注册 The Odds API 获取密钥

### Phase 2: 模拟交易 (第 4-7 天)

- [ ] 编写 Paper Vulture Bot
- [ ] 连接 Polymarket 测试网
- [ ] 运行 24 小时模拟
- [ ] 分析交易日志和 KPI
- [ ] 调整策略参数

### Phase 3: 实盘小额测试 (第 8-14 天)

- [ ] 存入 $20-$50 测试资金
- [ ] 启动 Swisstony 策略
- [ ] 监控 24/7 运行
- [ ] 每日复盘和日志分析
- [ ] 验证实际 ROI

### Phase 4: 策略优化 (第 15-21 天)

- [ ] 基于 Phase 3 数据优化参数
- [ ] 测试 Distinct-baguette (可选)
- [ ] 增加更多监控市场
- [ ] 优化 LLM 语义风控

### Phase 5: 全量部署 (第 22 天起)

- [ ] 增加资金至 $1000+
- [ ] 扩展至 100+ 市场
- [ ] 自动化日报生成
- [ ] 建立风险预警系统

---

## 📝 文件结构

```
workspace/
├── skills/
│   ├── poly_vulture.py          # Swisstony 策略核心
│   ├── poly_grid.py              # Distinct-baguette 策略核心
│   ├── skill_oracle.py          # 真理预言机
│   ├── paper_trading.py          # 模拟交易测试
│   └── risk_monitor.py          # 风险监控模块
├── data/
│   ├── markets.json              # 监控市场列表
│   ├── transactions.csv          # 交易记录
│   └── kpi_report.json           # 每日 KPI 报告
├── logs/
│   ├── trade_log_YYYY-MM-DD.json # 每日交易日志
│   └── error_log_YYYY-MM-DD.json  # 错误日志
└── AGENTS.md                     # 策略规则和经验
```

---

## 🎓 学习资源

### 官方文档
- [Polymarket CLOB Client](https://github.com/polymarket/py-clob-client)
- [The Odds API 文档](https://the-odds-api.com/docs)

### 社区资源
- [Reddit r/algotrading](https://reddit.com/r/algotrading)
- [Reddit r/Polymarket](https://reddit.com/r/Polymarket)
- [Discord Polymarket](https://discord.gg/polymarket)

### 研究案例
- Swisstony 链上交易历史: `[分析中]`
- Distinct-baguette 交易模式: `[分析中]`

---

## ⚠️ 重要声明

1. **模拟先行**: 绝对不要直接实盘，先在测试网模拟至少 7 天
2. **小额开始**: 实盘测试资金不超过 $50
3. **持续学习**: 市场在变化，策略需要不断优化
4. **风险意识**: 量化交易不是稳赚，任何策略都有亏损风险
5. **合规性**: 确保遵守 Polymarket 和相关监管机构的规定

---

**下一步行动**: 
1. 审读本纲领所有内容
2. 决定优先实施 Swisstony 还是 Distinct-baguette
3. 开始 Phase 1 环境搭建
4. 24 小时后汇报进度

**生成者**: OpenClaw Proactive Agent  
**版本**: 1.0  
**最后更新**: 2026-02-12

---

## 🔄 2026-02-13 更新（基于 Swisstony / Distinct-baguette 画像修正）

### Swisstony 画像要点（你提供的实盘观察）
- **高频 + 极度分散**：3.5万+笔，跨市场快速切换，小额、海量。
- **偏好低价 side**：常见 7¢/8¢/24¢/35¢（Underdog/Under/No）。
- **更像 Maker + 统计套利**：挂单吃错价/恐慌盘，赚 spread / 概率偏移，而非方向赌注。

### Distinct-baguette 画像要点
- **BTC/ETH 15分钟短周期**，高流动性市场。
- **同窗双边交易**（Up/Down 同时买卖），明显做市/剥头皮。
- **拆单追价**（63→64→65→66→67¢），订单切片。

### 纲领修正（必须落地的优化）
1) **执行方式从 Taker 纠正为 Maker**  
   - 仅限挂单，不追价吃单。
   - 阶梯挂单（stink bids）+ 小额碎单，模仿“高频低价填坑”。

2) **市场选择优先级**  
   - 只做**短周期 / 高流动性**（体育赛事 / 15min 级别合约）。
   - 禁止长周期政治盘（流动性差、信息不对称）。

3) **风险控制升级**  
   - LLM 语义避雷：若价格过低，先检查是否“死局”。
   - Maker Fill Rate 作为核心 KPI（过高=挂高了，过低=挂太低）。

4) **数据源限制说明**  
   - The Odds API 为免费版，不用 Historical Odds。
   - 只基于实时赔率做去水概率。

---

## ✅ 更新后的 Phase 1 目标（模拟盘）
1. **Maker-only 挂单引擎**（阶梯挂单 + 小额切片）
2. **Oracle 去水概率**（实时 Odds API，禁用历史数据）
3. **市场筛选器**（短周期 + 高流动性）
4. **Paper Trading 验证闭环**（24h 纸面成交率 + 反弹验证）
5. **最小闭环日志**（订单/成交/撤单明细 → CDN/Notion）

## ✅ 更新后的 Phase 1 达成路径
1) 安装依赖：`py-clob-client pandas requests aiohttp`
2) 写入并验证 `.env`（已完成）
3) 构建 **oracle + maker ladder** 原型脚本
4) 增加 **Paper Vulture**（30s 轮询 + 24h 验证）
5) 生成候选市场清单（优先 sports / short-term）
6) 产出 Phase 1 报告（含 KPI、日志样例）→ `/Polymarket/`

---

## 🧪 Paper Trading 设计（Swisstony 复刻验证）
**目的**：验证“低价挂单是否能接到恐慌盘”，并统计成交后的回弹情况。

**核心逻辑**
- 每 30 秒轮询最新成交价
- 若 `last_price <= target_bid (fair_prob * margin)` → 视为虚拟成交
- 记录成交后 1 小时/24 小时价格是否回归（评估是否接飞刀）

**成功信号**
- 多次出现“虚拟成交”
- 成交后价格回弹到公允区间

**失败信号**
- 成交后持续下跌（死局/重大新闻）

> 该模块将作为 Phase 1 最小闭环验证工具。后续进入 Phase 2 才考虑实盘。
